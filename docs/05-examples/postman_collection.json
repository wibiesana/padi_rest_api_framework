{
    "info": {
        "_postman_id": "mvc-rest-api-robust-v2",
        "name": "MVC REST API - Robust Complete Collection",
        "description": "Complete collection for Auth, Users, Posts, Tags, Comments, & Post-Tags with error-safe scripts.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "bearer",
        "bearer": [
            {
                "key": "token",
                "value": "{{auth_token}}",
                "type": "string"
            }
        ]
    },
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:8085"
        },
        {
            "key": "auth_token",
            "value": ""
        },
        {
            "key": "user_id",
            "value": ""
        },
        {
            "key": "post_id",
            "value": ""
        },
        {
            "key": "tag_id",
            "value": ""
        },
        {
            "key": "comment_id",
            "value": ""
        },
        {
            "key": "job_id",
            "value": ""
        },
        {
            "key": "migration_id",
            "value": ""
        },
        {
            "key": "post_tag_id",
            "value": ""
        },
        {
            "key": "available_at",
            "value": "1672531200"
        }
    ],
    "item": [
        {
            "name": "1. Authentication",
            "item": [
                {
                    "name": "Register User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201 || pm.response.code === 200) {",
                                    "        const res = pm.response.json();",
                                    "        const data = res.data || {};",
                                    "        if (data.token) pm.collectionVariables.set('auth_token', data.token);",
                                    "        const userId = data.user_id || (data.user ? data.user.id : null) || data.id;",
                                    "        if (userId) pm.collectionVariables.set('user_id', userId);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Test User\",\n    \"email\": \"test@example.com\",\n    \"password\": \"Test123!@#\",\n    \"password_confirmation\": \"Test123!@#\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/register"
                        }
                    }
                },
                {
                    "name": "Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 200) {",
                                    "        const res = pm.response.json();",
                                    "        const data = res.data || {};",
                                    "        if (data.token) pm.collectionVariables.set('auth_token', data.token);",
                                    "        const userId = data.user_id || (data.user ? data.user.id : null) || data.id;",
                                    "        if (userId) pm.collectionVariables.set('user_id', userId);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"Test123!@#\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login"
                        }
                    }
                },
                {
                    "name": "Get Me (Profile)",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/auth/me"
                        }
                    }
                }
            ]
        },
        {
            "name": "2. Users",
            "item": [
                {
                    "name": "List Users",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/users"
                        }
                    }
                },
                {
                    "name": "List All Users",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/users/all"
                        }
                    }
                },
                {
                    "name": "Get User By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/users/{{user_id}}"
                        }
                    }
                },
                {
                    "name": "Create User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.user?.id;",
                                    "        if (id) pm.collectionVariables.set('user_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"New User\",\n    \"email\": \"newuser@example.com\",\n    \"password\": \"Password123!\",\n    \"role\": \"user\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users"
                        }
                    }
                },
                {
                    "name": "Update User",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Name\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users/{{user_id}}"
                        }
                    }
                },
                {
                    "name": "Delete User",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/users/{{user_id}}"
                        }
                    }
                }
            ]
        },
        {
            "name": "3. Posts",
            "item": [
                {
                    "name": "List Posts",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/posts"
                        }
                    }
                },
                {
                    "name": "List All Posts",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/posts/all"
                        }
                    }
                },
                {
                    "name": "Query All Posts (Builder)",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/posts/query-all"
                        }
                    }
                },
                {
                    "name": "Create Post",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.post?.id;",
                                    "        if (id) pm.collectionVariables.set('post_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"user_id\": {{user_id}},\n    \"title\": \"My Robust Post\",\n    \"slug\": \"robust-post-test\",\n    \"content\": \"Post content for testing CRUD\",\n    \"status\": \"published\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/posts"
                        }
                    }
                },
                {
                    "name": "Get Post By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/posts/{{post_id}}"
                        }
                    }
                },
                {
                    "name": "Update Post",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"user_id\": {{user_id}},\n    \"title\": \"Updated Post Title\",\n    \"slug\": \"updated-post-test\",\n    \"status\": \"published\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/posts/{{post_id}}"
                        }
                    }
                },
                {
                    "name": "Delete Post",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/posts/{{post_id}}"
                        }
                    }
                }
            ]
        },
        {
            "name": "4. Tags",
            "item": [
                {
                    "name": "List Tags",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/tags"
                        }
                    }
                },
                {
                    "name": "List All Tags",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/tags/all"
                        }
                    }
                },
                {
                    "name": "Create Tag",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.tag?.id;",
                                    "        if (id) pm.collectionVariables.set('tag_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Testing Tag\",\n    \"slug\": \"testing-tag\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/tags"
                        }
                    }
                },
                {
                    "name": "Get Tag By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/tags/{{tag_id}}"
                        }
                    }
                },
                {
                    "name": "Update Tag",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Tag Name\",\n    \"slug\": \"updated-tag-slug\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/tags/{{tag_id}}"
                        }
                    }
                },
                {
                    "name": "Delete Tag",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/tags/{{tag_id}}"
                        }
                    }
                }
            ]
        },
        {
            "name": "5. Comments",
            "item": [
                {
                    "name": "List Comments",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/comments"
                        }
                    }
                },
                {
                    "name": "List All Comments",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/comments/all"
                        }
                    }
                },
                {
                    "name": "Create Comment",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.comment?.id;",
                                    "        if (id) pm.collectionVariables.set('comment_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"post_id\": {{post_id}},\n    \"user_id\": {{user_id}},\n    \"content\": \"Comment testing\",\n    \"status\": \"approved\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/comments"
                        }
                    }
                },
                {
                    "name": "Get Comment By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/comments/{{comment_id}}"
                        }
                    }
                },
                {
                    "name": "Update Comment",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"post_id\": {{post_id}},\n    \"user_id\": {{user_id}},\n    \"content\": \"Updated comment content\",\n    \"status\": \"approved\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/comments/{{comment_id}}"
                        }
                    }
                },
                {
                    "name": "Delete Comment",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/comments/{{comment_id}}"
                        }
                    }
                }
            ]
        },
        {
            "name": "6. Post Tags (Pivot)",
            "item": [
                {
                    "name": "List Post Tags",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/post_tags"
                        }
                    }
                },
                {
                    "name": "List All Post Tags",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/post_tags/all"
                        }
                    }
                },
                {
                    "name": "Link Post to Tag",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.posttag?.id;",
                                    "        if (id) pm.collectionVariables.set('post_tag_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"post_id\": {{post_id}},\n    \"tag_id\": {{tag_id}}\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/post_tags"
                        }
                    }
                },
                {
                    "name": "Get Post Tag By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/post_tags/{{post_tag_id}}"
                        }
                    }
                },
                {
                    "name": "Delete Post Tag",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/post_tags/{{post_tag_id}}"
                        }
                    }
                }
            ]
        },
        {
            "name": "7. Jobs",
            "item": [
                {
                    "name": "List Jobs",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/jobs"
                        }
                    }
                },
                {
                    "name": "List All Jobs",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/jobs/all"
                        }
                    }
                },
                {
                    "name": "Create Job",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.job?.id;",
                                    "        if (id) pm.collectionVariables.set('job_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"queue\": \"default\",\n    \"payload\": \"{\\\"job\\\":\\\"test\\\"}\",\n    \"available_at\": {{available_at}}\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/jobs"
                        }
                    }
                },
                {
                    "name": "Get Job By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/jobs/{{job_id}}"
                        }
                    }
                },
                {
                    "name": "Update Job",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"queue\": \"high\",\n    \"payload\": \"{\\\"job\\\":\\\"updated\\\"}\",\n    \"available_at\": {{available_at}}\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/jobs/{{job_id}}"
                        }
                    }
                },
                {
                    "name": "Delete Job",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/jobs/{{job_id}}"
                        }
                    }
                }
            ]
        },
        {
            "name": "8. Migrations",
            "item": [
                {
                    "name": "List Migrations",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/migrations"
                        }
                    }
                },
                {
                    "name": "List All Migrations",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/migrations/all"
                        }
                    }
                },
                {
                    "name": "Create Migration",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "try {",
                                    "    if (pm.response.code === 201) {",
                                    "        const res = pm.response.json();",
                                    "        const id = res.data?.id || res.data?.migration?.id;",
                                    "        if (id) pm.collectionVariables.set('migration_id', id);",
                                    "    }",
                                    "} catch (e) { console.warn('Script bypassed'); }"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"migration\": \"2023_01_01_000000_create_test_table\",\n    \"batch\": 1\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/migrations"
                        }
                    }
                },
                {
                    "name": "Get Migration By ID",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/migrations/{{migration_id}}"
                        }
                    }
                },
                {
                    "name": "Update Migration",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"migration\": \"2023_01_01_000000_updated_test_table\",\n    \"batch\": 2\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/migrations/{{migration_id}}"
                        }
                    }
                },
                {
                    "name": "Delete Migration",
                    "request": {
                        "method": "DELETE",
                        "url": {
                            "raw": "{{base_url}}/migrations/{{migration_id}}"
                        }
                    }
                }
            ]
        }
    ]
}